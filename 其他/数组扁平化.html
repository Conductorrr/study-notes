<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        var arr = [1, 2, [3, 4, 5, [6, [7]]], [8, [9, [10]]]]



        // 1、利用toString
        console.log(arr.toString()) // 1,2,3,4,5,6
        Array.prototype.myFlat1 = function () {
            return this.toString().split(',').map(item => parseInt(item))
        }
        console.log(arr.myFlat1());



        // 2、利用concat
        Array.prototype.myFlat3 = function () {
            var self = this; //（如果是this，循环里那句就要修改this了，但this是不能修改的，所以新声明一个变量）
            while (self.some(Array.isArray)) {
                self = [].concat(...self); // concat的参数可以是数组，也可以是具体的值，数组就会被扁平化
            }
            return self
        }
        console.log(arr.myFlat3());



        // 3、递归
        Array.prototype.myFlat4 = function () { 
            var self = this;
            let res = [],
            flatMap = (self) => {
                self.map((element) => {
                    if (Array.isArray(element)) {
                        flatMap(element);
                    } else {
                        res.push(element);
                    }
                })
            };
            flatMap(self);
            return res;
        }
        console.log(arr.myFlat4());



        // 4、控制维度：reduce、concat、递归
        Array.prototype.flat = function (depth = 1) {
            const myFlat = (arr, depth) => {
                if(depth > 0) {
                    return arr.reduce((pre, item) => {
                        return pre.concat(Array.isArray(item) ? myFlat(item, depth -1) : item)
                    }, [])
                }
                return arr
            }
            return myFlat(this, depth)
        }

        console.log(arr.flat(4))

    </script>
</body>

</html>